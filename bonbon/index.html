<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>BonBon Test üéØ - H·ªçc vui, thi ƒë·ªânh!</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            /* X√≥a highlight xanh khi tap tr√™n mobile */
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 80px;
            -webkit-overflow-scrolling: touch;
            /* Smooth scroll tr√™n iOS */
            touch-action: pan-y;
            /* Cho ph√©p scroll d·ªçc */
            /* Space for footer */
        }

        /* Animations */
        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-10px);
            }

            75% {
                transform: translateX(10px);
            }
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 40px 20px;
            animation: fadeInUp 0.6s ease-out;
        }

        .header h1 {
            font-size: 3.5em;
            color: white;
            text-shadow: 4px 4px 0px rgba(0, 0, 0, 0.2), 0 0 30px rgba(255, 255, 255, 0.3);
            margin-bottom: 10px;
            animation: float 3s ease-in-out infinite;
            letter-spacing: 2px;
        }

        .header p {
            font-size: 1.3em;
            color: #fff;
            opacity: 0.9;
        }

        /* Home Screen */
        #homeScreen {
            display: block;
        }

        .subject-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .subject-card {
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            animation: fadeInUp 0.6s ease-out;
            position: relative;
            overflow: hidden;
        }

        .subject-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.1) 0%, rgba(245, 87, 108, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .subject-card:hover::before {
            opacity: 1;
        }

        .subject-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 15px 40px rgba(245, 87, 108, 0.4);
        }

        .subject-icon {
            font-size: 5em;
            margin-bottom: 20px;
            display: block;
        }

        .subject-card h2 {
            font-size: 2em;
            color: #333;
            margin-bottom: 15px;
        }

        .subject-card p {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 20px;
        }

        .test-count {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 10px;
        }

        /* Test Selection Screen */
        #testSelectionScreen {
            display: none;
            animation: fadeInUp 0.6s ease-out;
        }

        .back-btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .test-btn {
            background: white;
            border: none;
            border-radius: 20px;
            padding: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .test-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(240, 147, 251, 0.15) 0%, rgba(245, 87, 108, 0.15) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .test-btn:hover::before {
            opacity: 1;
        }

        .test-btn:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 12px 30px rgba(245, 87, 108, 0.3);
        }

        .test-btn h3 {
            font-size: 1.8em;
            color: #333;
            margin-bottom: 10px;
        }

        .test-btn p {
            color: #666;
            font-size: 1em;
        }

        /* Quiz Screen */
        #quizScreen {
            display: none;
            animation: fadeInUp 0.6s ease-out;
        }

        .quiz-container {
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 900px;
            margin: 0 auto;
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .timer {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 20px;
            font-size: 1.3em;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .question-counter {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 20px;
            font-size: 1.2em;
            font-weight: 600;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .passage {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border-left: 5px solid #667eea;
            white-space: pre-wrap;
            line-height: 1.8;
            font-size: 1.05em;
        }

        .question {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 25px;
            font-weight: 600;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            background: #f8f9fa;
            border: 3px solid transparent;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1em;
            display: flex;
            align-items: center;
        }

        .option:hover {
            background: #e9ecef;
            transform: translateX(10px);
        }

        .option.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
            transform: scale(1.02);
        }

        .option.correct {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border-color: #11998e;
            animation: pulse 0.5s ease;
        }

        .option.wrong {
            background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
            color: white;
            border-color: #ee0979;
            animation: shake 0.5s ease;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }

        .nav-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 35px;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .submit-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        /* Result Screen */
        #resultScreen {
            display: none;
            animation: fadeInUp 0.6s ease-out;
        }

        .result-container {
            background: white;
            border-radius: 25px;
            padding: 50px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 700px;
            margin: 0 auto;
            text-align: center;
        }

        .result-emoji {
            font-size: 8em;
            animation: float 2s ease-in-out infinite;
            margin-bottom: 20px;
        }

        .result-score {
            font-size: 3em;
            color: #667eea;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .result-message {
            font-size: 1.5em;
            color: #666;
            margin-bottom: 30px;
        }

        .result-details {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            text-align: left;
        }

        .result-details p {
            font-size: 1.2em;
            color: #333;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 30px;
        }

        /* Review Screen */
        #reviewScreen {
            display: none;
            animation: fadeInUp 0.6s ease-out;
        }

        .review-container {
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 900px;
            margin: 0 auto;
        }

        .review-item {
            margin-bottom: 30px;
            padding: 25px;
            border-radius: 15px;
            background: #f8f9fa;
        }

        .review-item.correct {
            border-left: 5px solid #38ef7d;
        }

        .review-item.wrong {
            border-left: 5px solid #ff6a00;
        }

        .review-question {
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .review-answer {
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
        }

        .review-answer.user-answer {
            background: #fff3cd;
        }

        .review-answer.correct-answer {
            background: #d4edda;
        }

        /* Responsive - Mobile Friendly */
        @media (max-width: 768px) {
            body {
                padding-bottom: 100px;
                /* Space cho footer */
            }

            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2.2em;
                letter-spacing: 1px;
            }

            .header p {
                font-size: 1em;
            }

            .subject-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .subject-card {
                padding: 30px 20px;
            }

            .subject-icon {
                font-size: 4em;
            }

            .subject-card h2 {
                font-size: 1.6em;
            }

            .test-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .test-btn {
                padding: 20px;
            }

            .test-btn h3 {
                font-size: 1.3em;
            }

            .quiz-container,
            .result-container,
            .review-container {
                padding: 20px 15px;
                border-radius: 20px;
            }

            .quiz-header {
                flex-direction: column;
                gap: 10px;
                margin-bottom: 20px;
            }

            .timer,
            .question-counter {
                font-size: 1em;
                padding: 10px 15px;
            }

            .back-btn {
                padding: 10px 20px;
                font-size: 1em;
                width: 100%;
            }

            .passage {
                font-size: 1em;
                padding: 15px;
                line-height: 1.6;
            }

            .question {
                font-size: 1.1em;
                margin-bottom: 20px;
            }

            .option {
                padding: 15px;
                font-size: 1em;
                margin-bottom: 10px;
            }

            .nav-buttons {
                flex-direction: column;
                gap: 10px;
            }

            .nav-btn {
                width: 100%;
                padding: 12px 25px;
                font-size: 1em;
            }

            .result-emoji {
                font-size: 4em;
            }

            .result-score {
                font-size: 2.5em;
            }

            .result-message {
                font-size: 1.8em;
            }

            .result-details p {
                font-size: 1em;
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .action-buttons {
                flex-direction: column;
                width: 100%;
            }

            .action-buttons .nav-btn {
                width: 100%;
            }

            .review-item {
                padding: 15px;
                margin-bottom: 20px;
            }

            .review-question {
                font-size: 1em;
            }

            .review-answer {
                font-size: 0.95em;
            }

            .feedback-popup {
                font-size: 0.9em;
                padding: 10px 20px;
            }

            .footer-credit {
                bottom: 10px;
                padding: 8px 15px;
                gap: 8px;
            }

            .footer-credit .credit-text {
                font-size: 0.75em;
            }

            .footer-credit .avatar {
                width: 28px;
                height: 28px;
            }

            /* Bong b√≥ng nh·ªè h∆°n tr√™n mobile */
            .flying-image {
                box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
                border: 3px solid rgba(255, 255, 255, 1);
            }
        }

        /* Extra small screens */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8em;
            }

            .subject-card h2 {
                font-size: 1.4em;
            }

            .quiz-container,
            .result-container,
            .review-container {
                padding: 15px 10px;
            }

            .option {
                padding: 12px;
                font-size: 0.95em;
            }

            .result-emoji {
                font-size: 3em;
            }

            .result-score {
                font-size: 2em;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Feedback Animation */
        @keyframes feedbackFloat {
            0% {
                opacity: 0;
                transform: translate(-50%, 0) scale(0.5);
            }

            10% {
                opacity: 1;
                transform: translate(-50%, -10px) scale(1);
            }

            90% {
                opacity: 1;
                transform: translate(-50%, -60px) scale(1);
            }

            100% {
                opacity: 0;
                transform: translate(-50%, -80px) scale(0.8);
            }
        }

        .feedback-popup {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, 0);
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 1.1em;
            pointer-events: none;
            z-index: 1000;
            animation: feedbackFloat 1.5s ease-out forwards;
            white-space: nowrap;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .feedback-popup.correct {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .feedback-popup.wrong {
            background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
            color: white;
        }

        /* Flying Image Animation - Bubble Style */
        @keyframes bubbleFloat {
            0% {
                opacity: 1;
                transform: translateY(0) translateX(0) scale(0.8) rotate(0deg);
            }

            10% {
                opacity: 1;
                transform: translateY(-50px) translateX(0) scale(1.1) rotate(10deg);
            }

            100% {
                opacity: 0;
                transform: translateY(var(--distance)) translateX(var(--drift)) scale(var(--scale)) rotate(var(--rotate));
            }
        }

        .flying-image {
            position: fixed;
            width: var(--size);
            height: var(--size);
            border-radius: 50%;
            object-fit: cover;
            pointer-events: none;
            z-index: 9999;
            animation: bubbleFloat var(--duration) cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
            border: 5px solid rgba(255, 255, 255, 1);
            filter: brightness(1.3) contrast(1.3) saturate(1.4) drop-shadow(0 0 10px rgba(255, 255, 255, 0.5));
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }

        /* Footer Credit */
        .footer-credit {
            position: fixed;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 25px;
            border-radius: 50px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            backdrop-filter: blur(10px);
            animation: float 3s ease-in-out infinite;
        }

        .footer-credit .credit-text {
            font-size: 0.9em;
            color: #666;
            font-weight: 500;
        }

        .footer-credit .avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #f5576c;
            box-shadow: 0 3px 10px rgba(245, 87, 108, 0.4);
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üéØ BonBon Test</h1>
            <p>H·ªçc vui v·∫ª, thi th·∫≠t d·ªÖ! ‚ú®</p>
        </div>

        <!-- Home Screen -->
        <div id="homeScreen">
            <div class="subject-grid">
                <div class="subject-card" onclick="selectSubject('tienanh')">
                    <span class="subject-icon">üìö</span>
                    <h2>Ti·∫øng Anh</h2>
                    <p>English Tests</p>
                    <div class="test-count">6 Tests - Bao g·ªìm Test T·ªïng H·ª£p</div>
                </div>
                <div class="subject-card" onclick="selectSubject('hoa')">
                    <span class="subject-icon">üß™</span>
                    <h2>H√≥a H·ªçc</h2>
                    <p>Chemistry HK1</p>
                    <div class="test-count">1 Test - ƒê·∫ßy ƒë·ªß c√¢u h·ªèi</div>
                </div>
            </div>
        </div>

        <!-- Test Selection Screen -->
        <div id="testSelectionScreen">
            <button class="back-btn" onclick="goHome()">‚Üê Quay l·∫°i</button>
            <div id="testList" class="test-grid"></div>
        </div>

        <!-- Quiz Screen -->
        <div id="quizScreen">
            <div class="quiz-container">
                <div class="quiz-header">
                    <button class="back-btn" onclick="exitQuiz()">‚Üê Tho√°t</button>
                    <div class="timer" id="timer">‚è±Ô∏è <span id="timeLeft">00:00</span></div>
                    <div class="question-counter" id="questionCounter">C√¢u 1/24</div>
                </div>
                <div id="passage" class="passage" style="display: none;"></div>
                <div class="question" id="question"></div>
                <div class="options" id="options"></div>
                <div class="nav-buttons">
                    <button class="nav-btn" id="prevBtn" onclick="previousQuestion()">‚Üê C√¢u tr∆∞·ªõc</button>
                    <button class="nav-btn" id="nextBtn" onclick="nextQuestion()">C√¢u sau ‚Üí</button>
                    <button class="nav-btn submit-btn" id="submitBtn" onclick="submitQuiz()" style="display: none;">N·ªôp
                        b√†i üéâ</button>
                </div>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="resultScreen">
            <div class="result-container">
                <div class="result-emoji" id="resultEmoji">üéâ</div>
                <div class="result-score" id="resultScore">0/24</div>
                <div class="result-message" id="resultMessage">Xu·∫•t s·∫Øc!</div>
                <div class="result-details">
                    <p><strong>ƒêi·ªÉm s·ªë:</strong> <span id="scorePercent">100%</span></p>
                    <p><strong>ƒê√∫ng:</strong> <span id="correctCount">24</span></p>
                    <p><strong>Sai:</strong> <span id="wrongCount">0</span></p>
                    <p><strong>Th·ªùi gian:</strong> <span id="timeTaken">10:00</span></p>
                </div>
                <div class="action-buttons">
                    <button class="nav-btn" onclick="reviewAnswers()">üìù Xem ƒë√°p √°n</button>
                    <button class="nav-btn" onclick="retakeTest()">üîÑ L√†m l·∫°i</button>
                    <button class="nav-btn" onclick="goHome()">üè† Trang ch·ªß</button>
                </div>
            </div>
        </div>

        <!-- Review Screen -->
        <div id="reviewScreen">
            <div class="review-container">
                <button class="back-btn" onclick="backToResult()">‚Üê Quay l·∫°i k·∫øt qu·∫£</button>
                <h2 style="text-align: center; margin-bottom: 30px; color: #667eea; font-size: 2em;">üìù Xem l·∫°i ƒë√°p √°n
                </h2>
                <div id="reviewContent"></div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="nav-btn" onclick="goHome()">üè† Trang ch·ªß</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentSubject = '';
        let currentTest = null;
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let shuffledQuestions = [];
        let startTime = null;
        let timerInterval = null;

        // Preload images ƒë·ªÉ hi·ªán nhanh h∆°n
        const preloadedImages = {
            nmp: new Image(),
            bon: new Image()
        };
        preloadedImages.nmp.src = 'nmp.jpg';
        preloadedImages.bon.src = 'bon.jpg';

        // Shuffle function
        function shuffle(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Select subject
        function selectSubject(subject) {
            currentSubject = subject;
            document.getElementById('homeScreen').style.display = 'none';
            document.getElementById('testSelectionScreen').style.display = 'block';

            if (subject === 'tienanh') {
                loadEnglishTests();
            } else {
                loadChemistryTest();
            }
        }

        // Load English tests
        function loadEnglishTests() {
            const testList = document.getElementById('testList');
            testList.innerHTML = '';

            // Individual tests
            for (let i = 1; i <= 5; i++) {
                const testBtn = document.createElement('div');
                testBtn.className = 'test-btn';
                testBtn.onclick = () => startTest(i);
                testBtn.innerHTML = `
                    <h3>üìù Test ${i}</h3>
                    <p>24 c√¢u h·ªèi - ƒê√°p √°n ƒë∆∞·ª£c x√°o tr·ªôn m·ªói l·∫ßn l√†m</p>
                `;
                testList.appendChild(testBtn);
            }

            // Mixed test
            const mixedBtn = document.createElement('div');
            mixedBtn.className = 'test-btn';
            mixedBtn.style.background = 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)';
            mixedBtn.style.color = 'white';
            mixedBtn.onclick = () => startTest('mixed');
            mixedBtn.innerHTML = `
                <h3>üé≤ Test T·ªïng H·ª£p</h3>
                <p>24 c√¢u ng·∫´u nhi√™n t·ª´ t·∫•t c·∫£ c√°c test!</p>
            `;
            testList.appendChild(mixedBtn);
        }

        // Load Chemistry test
        function loadChemistryTest() {
            const testList = document.getElementById('testList');
            testList.innerHTML = `
                <div class="test-btn" onclick="startTest('hk1')">
                    <h3>üß™ H√≥a H·ªçc HK1</h3>
                    <p>T·∫•t c·∫£ c√¢u h·ªèi - ƒê√°p √°n ƒë∆∞·ª£c x√°o tr·ªôn m·ªói l·∫ßn l√†m</p>
                </div>
            `;
        }

        // Start test
        async function startTest(testNumber) {
            try {
                let testData;
                if (currentSubject === 'tienanh') {
                    if (testNumber === 'mixed') {
                        // Load all 5 tests and mix them
                        const allTests = [];
                        for (let i = 1; i <= 5; i++) {
                            const response = await fetch(`tienanh/test${i}.json`);
                            const data = await response.json();
                            allTests.push(...data.questions);
                        }

                        // Shuffle and pick random 24 questions
                        const shuffledAll = shuffle(allTests);
                        testData = {
                            testName: 'Test T·ªïng H·ª£p',
                            subject: 'Ti·∫øng Anh',
                            questions: shuffledAll.slice(0, 24)
                        };
                    } else {
                        const response = await fetch(`tienanh/test${testNumber}.json`);
                        testData = await response.json();
                    }
                } else {
                    const response = await fetch(`hoa/hk1.json`);
                    testData = await response.json();
                }

                currentTest = testData;

                // Nh√≥m c√°c c√¢u h·ªèi theo ƒëo·∫°n vƒÉn (passage groups)
                const passageGroups = [];
                let currentGroup = [];

                testData.questions.forEach((q, index) => {
                    currentGroup.push(q);

                    // N·∫øu c√¢u ti·∫øp theo c√≥ passage kh√°c ho·∫∑c l√† c√¢u cu·ªëi
                    const isLastQuestion = index === testData.questions.length - 1;
                    const nextHasDifferentPassage = !isLastQuestion &&
                        testData.questions[index + 1].passage !== q.passage;

                    if (isLastQuestion || nextHasDifferentPassage) {
                        passageGroups.push(currentGroup);
                        currentGroup = [];
                    }
                });

                // X√°o tr·ªôn c√°c nh√≥m ƒëo·∫°n vƒÉn
                const shuffledGroups = shuffle(passageGroups);

                // G·ªôp l·∫°i th√†nh danh s√°ch c√¢u h·ªèi m·ªõi v√† x√°o tr·ªôn ƒë√°p √°n
                shuffledQuestions = shuffledGroups.flat().map(q => {
                    return {
                        ...q,
                        shuffledOptions: shuffle(q.options.map((opt, idx) => ({
                            text: opt,
                            originalIndex: idx
                        })))
                    };
                });

                userAnswers = new Array(shuffledQuestions.length).fill(null);
                currentQuestionIndex = 0;
                startTime = Date.now();

                document.getElementById('testSelectionScreen').style.display = 'none';
                document.getElementById('quizScreen').style.display = 'block';

                startTimer();
                displayQuestion();
            } catch (error) {
                alert('Kh√¥ng th·ªÉ t·∫£i b√†i test. Vui l√≤ng th·ª≠ l·∫°i!');
                console.error(error);
            }
        }

        // Start timer
        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timeLeft').textContent =
                    `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }, 1000);
        }

        // Display question
        function displayQuestion() {
            const question = shuffledQuestions[currentQuestionIndex];

            // Update counter
            document.getElementById('questionCounter').textContent =
                `C√¢u ${currentQuestionIndex + 1}/${shuffledQuestions.length}`;

            // Show/hide passage
            const passageDiv = document.getElementById('passage');
            if (question.passage && question.passage.trim() !== '') {
                passageDiv.style.display = 'block';
                passageDiv.textContent = question.passage;
            } else {
                passageDiv.style.display = 'none';
            }

            // Display question
            document.getElementById('question').textContent = question.question;

            // Display options - lu√¥n hi·ªÉn th·ªã theo th·ª© t·ª± A, B, C, D
            const optionsDiv = document.getElementById('options');
            optionsDiv.innerHTML = '';

            const labels = ['A', 'B', 'C', 'D'];
            const isAnswered = userAnswers[currentQuestionIndex] !== null;

            question.shuffledOptions.forEach((option, displayIndex) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';

                // B·ªè ph·∫ßn "A. ", "B. ", "C. ", "D. " kh·ªèi text g·ªëc v√† th√™m label m·ªõi
                const cleanText = option.text.replace(/^[A-D]\.\s*/, '');
                optionDiv.textContent = `${labels[displayIndex]}. ${cleanText}`;

                // N·∫øu c√¢u ƒë√£ ƒë∆∞·ª£c tr·∫£ l·ªùi, hi·ªÉn th·ªã k·∫øt qu·∫£
                if (isAnswered) {
                    optionDiv.style.pointerEvents = 'none';
                    if (option.originalIndex === question.correctAnswer) {
                        optionDiv.classList.add('correct');
                    } else if (option.originalIndex === userAnswers[currentQuestionIndex]) {
                        optionDiv.classList.add('wrong');
                    }
                } else {
                    // Ch∆∞a tr·∫£ l·ªùi th√¨ cho ph√©p click
                    optionDiv.onclick = () => selectOption(option.originalIndex);
                }

                optionsDiv.appendChild(optionDiv);
            });

            // ·∫®n navigation buttons v√¨ gi·ªù t·ª± ƒë·ªông chuy·ªÉn c√¢u
            document.getElementById('prevBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('submitBtn').style.display =
                currentQuestionIndex === shuffledQuestions.length - 1 && isAnswered ? 'block' : 'none';
        }

        // Select option
        function selectOption(originalIndex) {
            // L∆∞u c√¢u tr·∫£ l·ªùi
            userAnswers[currentQuestionIndex] = originalIndex;

            const question = shuffledQuestions[currentQuestionIndex];
            const isCorrect = originalIndex === question.correctAnswer;

            // M·∫£ng feedback text
            const correctMessages = [
                '10 ƒëi·ªÉm üåü',
                'tuy·ªát v·ªùi √¥ng m·∫∑t tr·ªùi ‚òÄÔ∏è',
                'gi·ªèi c√° üêü',
                'qu√° d·ªØ üî•',
                'ƒë·ªânh üèîÔ∏è',
                'th·∫ßn k√¨ üòé',
                'xu·∫•t s·∫Øc üéâ',
                'pro player üéÆ',
                'qu√° tr·ªùi lu√¥n ‚ö°',
                'si√™u sao üåü'
            ];

            const wrongMessages = [
                'ch√∫c b·∫°n may m·∫Øn l·∫ßn sau üçÄ',
                'liu liu sai r·ªìi üòÖ',
                'ng·ªù g√¨ m√† uuuu üò¢',
                'sai b√©c üò≠',
                '1 ƒëi·ªÉm v·ªÅ ch·ªó üìâ',
                '∆° hay hay ü§î',
                'g·∫ßn ƒë√∫ng r·ªìi üò¨',
                'l·∫ßn sau c·ªë l√™n üí™',
                'oops üò≥',
                'ui ch√† ch√† üôà'
            ];

            // Random message
            const messages = isCorrect ? correctMessages : wrongMessages;
            const randomMessage = messages[Math.floor(Math.random() * messages.length)];

            // Hi·ªÉn th·ªã k·∫øt qu·∫£ ngay l·∫≠p t·ª©c
            const optionsDiv = document.getElementById('options');
            const allOptions = optionsDiv.querySelectorAll('.option');

            allOptions.forEach((optionDiv, index) => {
                const optionData = question.shuffledOptions[index];

                // V√¥ hi·ªáu h√≥a t·∫•t c·∫£ options
                optionDiv.style.pointerEvents = 'none';

                // ƒê√°nh d·∫•u ƒë√°p √°n ƒë√∫ng
                if (optionData.originalIndex === question.correctAnswer) {
                    optionDiv.classList.add('correct');
                }

                // ƒê√°nh d·∫•u ƒë√°p √°n sai (n·∫øu user ch·ªçn sai)
                if (optionData.originalIndex === originalIndex && !isCorrect) {
                    optionDiv.classList.add('wrong');
                }
            });

            // Hi·ªÉn th·ªã feedback popup
            const feedbackPopup = document.createElement('div');
            feedbackPopup.className = `feedback-popup ${isCorrect ? 'correct' : 'wrong'}`;
            feedbackPopup.textContent = randomMessage;
            optionsDiv.style.position = 'relative';
            optionsDiv.appendChild(feedbackPopup);

            // T·ª± ƒë·ªông x√≥a popup sau animation
            setTimeout(() => {
                feedbackPopup.remove();
            }, 1500);

            // Hi·ªáu ·ª©ng ·∫£nh bay t·ª© tung
            createFlyingImages(isCorrect);

            // T·ª± ƒë·ªông chuy·ªÉn sang c√¢u ti·∫øp theo sau 1.5 gi√¢y
            setTimeout(() => {
                if (currentQuestionIndex < shuffledQuestions.length - 1) {
                    currentQuestionIndex++;
                    displayQuestion();
                } else {
                    // N·∫øu l√† c√¢u cu·ªëi, hi·ªán n√∫t Submit
                    document.getElementById('submitBtn').style.display = 'block';
                }
            }, 1500);
        }

        // T·∫°o hi·ªáu ·ª©ng ·∫£nh bay t·ª© tung - Bubble style
        function createFlyingImages(isCorrect) {
            const imageSrc = isCorrect ? 'nmp.jpg' : 'bon.jpg';

            // ƒêi·ªÅu ch·ªânh s·ªë l∆∞·ª£ng theo k√≠ch th∆∞·ªõc m√†n h√¨nh
            const isMobile = window.innerWidth <= 768;
            const imageCount = isCorrect ? (isMobile ? 12 : 20) : (isMobile ? 8 : 15);

            // T·∫°o T·∫§T C·∫¢ bong b√≥ng NGAY L·∫¨P T·ª®C - kh√¥ng delay!
            for (let i = 0; i < imageCount; i++) {
                const img = document.createElement('img');
                // D√πng ·∫£nh ƒë√£ preload ƒë·ªÉ load nhanh h∆°n
                img.src = imageSrc;
                img.className = 'flying-image';

                // Random size - Nh·ªè h∆°n tr√™n mobile
                const baseSize = isMobile ? 50 : 80;
                const sizeRange = isMobile ? 60 : 100;
                const size = baseSize + Math.random() * sizeRange; // Mobile: 50-110px, Desktop: 80-180px
                img.style.setProperty('--size', size + 'px');

                // Random scale cu·ªëi (ƒë·ªÉ t·∫°o chi·ªÅu s√¢u)
                const finalScale = 0.7 + Math.random() * 0.6; // t·ª´ 0.7 ƒë·∫øn 1.3
                img.style.setProperty('--scale', finalScale);

                // Duration k√©o d√†i h∆°n 1 ch√∫t
                const duration = 1.8 + Math.random() * 0.6; // t·ª´ 1.8s ƒë·∫øn 2.4s
                img.style.setProperty('--duration', duration + 's');

                // V·ªã tr√≠ xu·∫•t ph√°t t·ª´ d∆∞·ªõi m√†n h√¨nh (random X)
                const startX = Math.random() * window.innerWidth;
                const startY = window.innerHeight + 100;

                img.style.left = startX + 'px';
                img.style.top = startY + 'px';

                // Bay l√™n cao h∆°n m·ªôt ch√∫t (ph√π h·ª£p v·ªõi duration d√†i h∆°n)
                const distance = -(500 + Math.random() * 400); // Bay cao h∆°n t√≠
                img.style.setProperty('--distance', distance + 'px');

                // Drift (tr√¥i ngang v·ª´a ph·∫£i)
                const drift = (Math.random() - 0.5) * 250;
                img.style.setProperty('--drift', drift + 'px');

                // Rotation (xoay nhanh h∆°n)
                const rotateFinal = (Math.random() - 0.5) * 180; // Xoay √≠t h∆°n
                img.style.setProperty('--rotate', rotateFinal + 'deg');

                // Fallback n·∫øu ·∫£nh kh√¥ng load ƒë∆∞·ª£c
                img.onerror = function () {
                    if (isCorrect) {
                        this.src = 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ccircle cx=%2250%22 cy=%2250%22 r=%2250%22 fill=%22%2338ef7d%22/%3E%3Ctext x=%2250%22 y=%2250%22 text-anchor=%22middle%22 dy=%22.3em%22 font-size=%2240%22 fill=%22white%22%3E‚úì%3C/text%3E%3C/svg%3E';
                    } else {
                        this.src = 'data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ccircle cx=%2250%22 cy=%2250%22 r=%2250%22 fill=%22%23ff6a00%22/%3E%3Ctext x=%2250%22 y=%2250%22 text-anchor=%22middle%22 dy=%22.3em%22 font-size=%2240%22 fill=%22white%22%3E‚úó%3C/text%3E%3C/svg%3E';
                    }
                };

                document.body.appendChild(img);

                // T·ª± ƒë·ªông x√≥a sau khi animation xong
                setTimeout(() => {
                    img.remove();
                }, duration * 1000);
            }
        }

        // Previous question
        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                displayQuestion();
            }
        }

        // Next question
        function nextQuestion() {
            if (currentQuestionIndex < shuffledQuestions.length - 1) {
                currentQuestionIndex++;
                displayQuestion();
            }
        }

        // Submit quiz
        function submitQuiz() {
            const unanswered = userAnswers.filter(a => a === null).length;
            if (unanswered > 0) {
                if (!confirm(`B·∫°n c√≤n ${unanswered} c√¢u ch∆∞a tr·∫£ l·ªùi. B·∫°n c√≥ ch·∫Øc mu·ªën n·ªôp b√†i?`)) {
                    return;
                }
            }

            clearInterval(timerInterval);
            showResults();
        }

        // Show results
        function showResults() {
            const correctCount = userAnswers.filter((answer, index) =>
                answer === shuffledQuestions[index].correctAnswer
            ).length;
            const wrongCount = shuffledQuestions.length - correctCount;
            const scorePercent = Math.round((correctCount / shuffledQuestions.length) * 100);

            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            const timeTaken = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

            // Determine emoji and message
            let emoji = 'üéâ';
            let message = 'Xu·∫•t s·∫Øc!';
            if (scorePercent >= 90) {
                emoji = 'üèÜ';
                message = 'Xu·∫•t s·∫Øc! B·∫°n qu√° ƒë·ªânh! üî•';
            } else if (scorePercent >= 80) {
                emoji = 'üéâ';
                message = 'Tuy·ªát v·ªùi! L√†m t·ªët l·∫Øm! ‚≠ê';
            } else if (scorePercent >= 70) {
                emoji = 'üëç';
                message = 'Kh√° ƒë·∫•y! C·ªë g·∫Øng th√™m nh√©! üí™';
            } else if (scorePercent >= 50) {
                emoji = 'üìö';
                message = '·ªîn ƒë·∫•y! H·ªçc th√™m m·ªôt ch√∫t n·ªØa nha! üòä';
            } else {
                emoji = 'üí™';
                message = 'C·ªë l√™n! L·∫ßn sau s·∫Ω t·ªët h∆°n! üåü';
            }

            document.getElementById('resultEmoji').textContent = emoji;
            document.getElementById('resultScore').textContent = `${correctCount}/${shuffledQuestions.length}`;
            document.getElementById('resultMessage').textContent = message;
            document.getElementById('scorePercent').textContent = `${scorePercent}%`;
            document.getElementById('correctCount').textContent = correctCount;
            document.getElementById('wrongCount').textContent = wrongCount;
            document.getElementById('timeTaken').textContent = timeTaken;

            document.getElementById('quizScreen').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'block';
        }

        // Review answers
        function reviewAnswers() {
            const reviewContent = document.getElementById('reviewContent');
            reviewContent.innerHTML = '';

            shuffledQuestions.forEach((question, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer === question.correctAnswer;

                const reviewItem = document.createElement('div');
                reviewItem.className = `review-item ${isCorrect ? 'correct' : 'wrong'}`;

                let html = `
                    <div class="review-question">
                        <strong>C√¢u ${index + 1}:</strong> ${question.question}
                    </div>
                `;

                if (question.passage && question.passage.trim() !== '') {
                    html += `<div class="passage" style="font-size: 0.95em; margin: 10px 0;">${question.passage}</div>`;
                }

                // Show user's answer
                if (userAnswer !== null) {
                    // B·ªè ph·∫ßn "A. ", "B. ", "C. ", "D. " kh·ªèi ƒë√°p √°n
                    const userAnswerText = question.options[userAnswer].replace(/^[A-D]\.\s*/, '');
                    html += `
                        <div class="review-answer user-answer">
                            <strong>C√¢u tr·∫£ l·ªùi c·ªßa b·∫°n:</strong> ${userAnswerText}
                            ${isCorrect ? '‚úÖ' : '‚ùå'}
                        </div>
                    `;
                } else {
                    html += `
                        <div class="review-answer user-answer">
                            <strong>B·∫°n ch∆∞a tr·∫£ l·ªùi c√¢u n√†y</strong> ‚ö†Ô∏è
                        </div>
                    `;
                }

                // Show correct answer
                if (!isCorrect) {
                    // B·ªè ph·∫ßn "A. ", "B. ", "C. ", "D. " kh·ªèi ƒë√°p √°n ƒë√∫ng
                    const correctAnswerText = question.options[question.correctAnswer].replace(/^[A-D]\.\s*/, '');
                    html += `
                        <div class="review-answer correct-answer">
                            <strong>ƒê√°p √°n ƒë√∫ng:</strong> ${correctAnswerText} ‚úÖ
                        </div>
                    `;
                }

                reviewItem.innerHTML = html;
                reviewContent.appendChild(reviewItem);
            });

            document.getElementById('resultScreen').style.display = 'none';
            document.getElementById('reviewScreen').style.display = 'block';
        }

        // Back to result
        function backToResult() {
            document.getElementById('reviewScreen').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'block';
        }

        // Retake test
        function retakeTest() {
            if (currentSubject === 'tienanh') {
                const testNumber = currentTest.testName.match(/\d+/)[0];
                startTest(parseInt(testNumber));
            } else {
                startTest('hk1');
            }
        }

        // Exit quiz
        function exitQuiz() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën tho√°t? K·∫øt qu·∫£ s·∫Ω kh√¥ng ƒë∆∞·ª£c l∆∞u.')) {
                clearInterval(timerInterval);
                goHome();
            }
        }

        // Go home
        function goHome() {
            clearInterval(timerInterval);
            document.getElementById('homeScreen').style.display = 'block';
            document.getElementById('testSelectionScreen').style.display = 'none';
            document.getElementById('quizScreen').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'none';
            document.getElementById('reviewScreen').style.display = 'none';
            currentSubject = '';
            currentTest = null;
        }
    </script>

    <!-- Footer Credit -->
    <div class="footer-credit">
        <span class="credit-text">by nmp</span>
        <img src="nmp.jpg" alt="NMP Avatar" class="avatar"
            onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Ccircle cx=%2250%22 cy=%2250%22 r=%2250%22 fill=%22%23f5576c%22/%3E%3Ctext x=%2250%22 y=%2250%22 text-anchor=%22middle%22 dy=%22.3em%22 font-size=%2245%22 fill=%22white%22 font-family=%22Fredoka%22%3ENMP%3C/text%3E%3C/svg%3E'">
    </div>
</body>

</html>